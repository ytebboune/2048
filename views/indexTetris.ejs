<% var title = 'Page accueil' %>
<% include head %>
<script type="text/javascript" src="js/tetris.js"></script>

<body onload="init();">

<h1>2048 : Mode Tetris</h1>

<div id="jeu">
    <div class="ligne">
        <div class="case" id="ligne1" style="color:black;"></div>
        <div class="case" id="ligne1" style="color:black;"></div>
        <div class="case" id="ligne1" style="color:black;"></div>
        <div class="case" id="ligne1" style="color:black;"></div>
    </div>
    <div class="ligne">
        <div class="case"></div>
        <div class="case"></div>
        <div class="case"></div>
        <div class="case"></div>
    </div>
    <div class="ligne">
        <div class="case"></div>
        <div class="case"></div>
        <div class="case"></div>
        <div class="case"></div>
    </div>
    <div class="message"></div>

    <div class="ligne">
        <div class="case"></div>
        <div class="case"></div>
        <div class="case"></div>
        <div class="case"></div>
    </div>
    <div class="ligne">
        <div class="case"></div>
        <div class="case"></div>
        <div class="case"></div>
        <div class="case"></div>
    </div>
</div>

<div class="swapMode">
    <a href="index">
        <button type="button" id="btnMode1" class="btn btn-primary btn-lg">Mode standard</button>
    </a>
    <button type="button" id="btnMode2" class="btn btn-secondary btn-lg" disabled>Mode Tetris</button>
</div>

<div id="btn_jeu">
    <div class="btn_2048"><a href="indexTetris">DÃ©marrer</a></div>
    <div class="btn_2048"><a href="indexTetris">Recommencer</a></div>
</div>

<div class="col-sm-3 col-sm-offset-4 frame" style="position: fixed; bottom:50px; margin-left: 70%; width: 20%;">
    <div>
        <ul id="messages"></ul>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.slim.js"></script>

    <script>
        var socket = io.connect("http://localhost:3000");
        $(function() {
            socket.on('histo', historique => {
                historique.forEach(msg => {
                $('#messages').append($('<p>').text(msg.author + " : " + msg.text));
        });
        });
            socket.on('chat message', msg => {
                $('#messages').append($('<p>').text(msg.author + " : " + msg.text));
            window.scrollTo(0, document.body.scrollHeight);
        });
        });
    </script>
    <div class="msj-rta macro">
        <div class="text text-r">
            <form action="" id="formChat">
                <input id="m" autocomplete="off" placeholder="Entrez votre message..." style="padding:6px; margin-left:30%; margin-top: 3%; width:65%; border-radius:6px;" />
                <button class="btn btn-primary navbar-btn" style="margin-left: 50%;">Envoyer</button>
                <script>
                    $(function() {
                        var author = "<%= _username %>"; //TODO changer par votre moyen de connaitre l'utilisateur courant
                        $('#formChat').submit(() => {
                            if ($('#m').val().trim() != "") {
                            socket.emit('chat message', {
                                "author": author,
                                "text": $('#m').val()
                            });
                            $('#m').val('');
                        }
                        return false;
                    });
                    });
                </script>
            </form>
        </div>

    </div>

</div>

</body>

<% include foot %>
